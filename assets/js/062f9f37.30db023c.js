"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9631],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return h}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=p(n),h=o,c=u["".concat(s,".").concat(h)]||u[h]||d[h]||i;return n?a.createElement(c,r(r({ref:t},m),{},{components:n})):a.createElement(c,r({ref:t},m))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4912:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return m},default:function(){return u}});var a=n(7462),o=n(3366),i=(n(7294),n(3905)),r=["components"],l={id:"android-dev-env",slug:"introduction/android-dev-env",title:"Setting Up an Android Development & Testing Environment",sidebar_label:"Setting Up an Android Development & Testing Environment"},s=void 0,p={unversionedId:"android-dev-env",id:"android-dev-env",isDocsHomePage:!1,title:"Setting Up an Android Development & Testing Environment",description:"Setting Up an Android Development & Testing Environment",source:"@site/../docs/Introduction.AndroidDevEnv.md",sourceDirName:".",slug:"/introduction/android-dev-env",permalink:"/Detox/docs/introduction/android-dev-env",editUrl:"https://github.com/wix/Detox/edit/master/docs/../docs/Introduction.AndroidDevEnv.md",tags:[],version:"current",frontMatter:{id:"android-dev-env",slug:"introduction/android-dev-env",title:"Setting Up an Android Development & Testing Environment",sidebar_label:"Setting Up an Android Development & Testing Environment"},sidebar:"tutorialSidebar",previous:{title:"Setting Up an iOS Development & Testing Environment",permalink:"/Detox/docs/introduction/ios-dev-env"},next:{title:"Detox for iOS",permalink:"/Detox/docs/introduction/ios"}},m=[{value:"Setting Up an Android Development &amp; Testing Environment",id:"setting-up-an-android-development--testing-environment",children:[],level:2},{value:"Java Setup",id:"java-setup",children:[],level:2},{value:"Android SDK",id:"android-sdk",children:[],level:2},{value:"Android (AOSP) Emulators",id:"android-aosp-emulators",children:[{value:"Here\u2019s how to install them using the command line",id:"heres-how-to-install-them-using-the-command-line",children:[],level:3},{value:"Installing from Android Studio",id:"installing-from-android-studio",children:[],level:3}],level:2},{value:"Emulator Quick-Boot",id:"emulator-quick-boot",children:[{value:"Setting up a quick-boot snapshot from the Emulator",id:"setting-up-a-quick-boot-snapshot-from-the-emulator",children:[],level:3},{value:"Setting up a quick-boot snapshot from command-line",id:"setting-up-a-quick-boot-snapshot-from-command-line",children:[],level:3},{value:"Disclaimer",id:"disclaimer",children:[],level:3}],level:2},{value:"Cheatsheet",id:"cheatsheet",children:[{value:"Locating the AVD\u2019s home directory",id:"locating-the-avds-home-directory",children:[],level:3},{value:"Booting an emulator via command-line",id:"booting-an-emulator-via-command-line",children:[{value:"Shortcut for booting a verbose, visible emulator in a GUI supporting system",id:"shortcut-for-booting-a-verbose-visible-emulator-in-a-gui-supporting-system",children:[],level:4}],level:3},{value:"Verifying the emulator\u2019s quick-boot snapshot has been saved",id:"verifying-the-emulators-quick-boot-snapshot-has-been-saved",children:[],level:3}],level:2}],d={toc:m};function u(e){var t=e.components,l=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"setting-up-an-android-development--testing-environment"},"Setting Up an Android Development & Testing Environment"),(0,i.kt)("p",null,"This guide provides some core practices to follow in setting up a stable, reliable environment for running automated UI tests using Android emulators (using Detox, in particular) -- be it on a personal, ",(0,i.kt)("em",{parentName:"p"},"local")," computer, or a powerful CI machine."),(0,i.kt)("p",null,"Note that running automated UI tests is ",(0,i.kt)("em",{parentName:"p"},"not the same")," as developing Android apps. Hence, you may find yourself not 100% aligned with the recommendations here, and should consider being so."),(0,i.kt)("h2",{id:"java-setup"},"Java Setup"),(0,i.kt)("p",null,"This is the most basic step in the process, as without a proper Java SDK installed, nothing Android-ish works -- at least not from command-line, which is mandatory for executing ",(0,i.kt)("inlineCode",{parentName:"p"},"Detox"),"."),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"The bottom line is that ",(0,i.kt)("strong",{parentName:"em"},"Android needs Java 1.8 installed"),".")),(0,i.kt)("p",null,"To check for your real java-executable\u2019s version, in a command-line console, run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"java -version\n")),(0,i.kt)("p",null,"What needs to be verified is that ",(0,i.kt)("inlineCode",{parentName:"p"},"java")," is in-path and that the output contains something as this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'java version "1.8.0_121"\n...\n')),(0,i.kt)("p",null,"Namely, that the version is ",(0,i.kt)("inlineCode",{parentName:"p"},"1.8.x_abc"),"."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note: Do not be confused by the Java version potentially used by your browsers, etc. For ",(0,i.kt)("inlineCode",{parentName:"p"},"Detox"),", what the command-line sees is what matters.")),(0,i.kt)("p",null,"On macOS, in particular, java comes from both the OS ",(0,i.kt)("em",{parentName:"p"},"and")," possibly other installers such as ",(0,i.kt)("inlineCode",{parentName:"p"},"homebrew"),", so you are more likely to go into a mess: see ",(0,i.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/24342886/how-to-install-java-8-on-mac"},"this Stack Overflow post"),"."),(0,i.kt)("hr",null),(0,i.kt)("p",null,"If ",(0,i.kt)("inlineCode",{parentName:"p"},"java")," isn\u2019t in your path or not even installed (i.e. the command failed altogether), try ",(0,i.kt)("a",{parentName:"p",href:"https://www.java.com/en/download/help/path.xml"},"this guide"),"."),(0,i.kt)("p",null,"If otherwise the version is simply wrong, try these refs for Macs; consider employing the ",(0,i.kt)("inlineCode",{parentName:"p"},"JAVA_HOME")," variable to get things to work right:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://java.com/en/download/faq/java_mac.xml#version"},"https://java.com/en/download/faq/java_mac.xml#version")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.java.com/en/download/help/version_manual.xml"},"https://www.java.com/en/download/help/version_manual.xml")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://medium.com/notes-for-geeks/java-home-and-java-home-on-macos-f246cab643bd"},"https://medium.com/notes-for-geeks/java-home-and-java-home-on-macos-f246cab643bd"))),(0,i.kt)("h2",{id:"android-sdk"},"Android SDK"),(0,i.kt)("p",null,"If you have Android Studio installed - as most of us do, then the SDK should be available for you somewhere on your machine",(0,i.kt)("sup",null,"*"),". However, for CI agents -- possibly running with no GUI, or if you simply don\u2019t want the somewhat bloated piece of software on your computer, it is possible to simply download the SDK and tool-set, purely. Both cases are covered in Google\u2019s ",(0,i.kt)("a",{parentName:"p",href:"https://developer.android.com/studio/"},"Android guide about Android Studio"),". For the pure-tools option, refer to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Command line tools only")," section at the bottom."),(0,i.kt)("p",null,"For more help on setting the SDK up, ",(0,i.kt)("a",{parentName:"p",href:"https://www.androidcentral.com/installing-android-sdk-windows-mac-and-linux-tutorial"},"this guide might be helpful"),"."),(0,i.kt)("p",null,"Whatever option you choose, and whichever platform you\u2019re running on (Mac, Linux, Windows), we strongly recommend that eventually you would have 2 additional things set up:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The path to the SDK\u2019s root directory is set into the ",(0,i.kt)("inlineCode",{parentName:"li"},"ANDROID_SDK_ROOT")," ",(0,i.kt)("a",{parentName:"li",href:"https://developer.android.com/studio/command-line/variables"},"environment variable"),"."),(0,i.kt)("li",{parentName:"ul"},"The path to the SDK\u2019s root directory is bundled into the global ",(0,i.kt)("a",{parentName:"li",href:"https://superuser.com/questions/284342/what-are-path-and-other-environment-variables-and-how-can-i-set-or-use-them"},(0,i.kt)("inlineCode",{parentName:"a"},"PATH"))," on your computer.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},(0,i.kt)("sup",null,"*"," Inspect the content of your ",(0,i.kt)("inlineCode",{parentName:"em"},"ANDROID_SDK_ROOT")," and ",(0,i.kt)("inlineCode",{parentName:"em"},"ANDROID_HOME")," environment variables."))),(0,i.kt)("h2",{id:"android-aosp-emulators"},"Android (AOSP) Emulators"),(0,i.kt)("p",null,"Mobile-apps' automation needs an Android device to run on. If you haven\u2019t already done so, you should  ",(0,i.kt)("a",{parentName:"p",href:"https://developer.android.com/studio/run/emulator"},"set up an Emulator"),". But, wait - don\u2019t go and install the default one: read through, first."),(0,i.kt)("p",null,"We\u2019ve long proven that for automation - which requires a stable and deterministic environment, Google\u2019s emulators running with Google APIs simply don\u2019t deliver what\u2019s needed. Be it the preinstalled Google play-services - which tend to take up a lot of CPU, or even Google\u2019s ",(0,i.kt)("inlineCode",{parentName:"p"},"gboard")," Keyboard - which is full-featured but overly bloated: These encourage flakiness in tests, which we are desperate to avoid in automation."),(0,i.kt)("p",null,"Fortunately, the Android team at Google offers a pretty decent alternative: ",(0,i.kt)("strong",{parentName:"p"},"AOSP emulators")," (Android Open-Source Project). While possibly lacking some of the extended Google services, and a bit less fancy overall, ",(0,i.kt)("strong",{parentName:"p"},"we strongly recommend")," to strictly use this flavor of emulators for running automation/Detox tests. They can be installed alongside regular emulators."),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Here\u2019s a visual comparison between the two - an SDK 28 (Android 9) AOSP emulator (left) vs. an emulator with Google APIs installed (right):")),(0,i.kt)("img",{src:"img/android/aosp-vs-googleapi.png",alt:"AOSP vs Google-API"}),(0,i.kt)("h3",{id:"heres-how-to-install-them-using-the-command-line"},"Here\u2019s how to install them using the command line"),(0,i.kt)("p",null,"While it\u2019s possible to do this using Android Studio, we\u2019ll focus on the command line, as it is also good for ",(0,i.kt)("em",{parentName:"p"},"headless")," CI machines."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Locate your 'Android home' folder - typically set in the ",(0,i.kt)("inlineCode",{parentName:"p"},"ANDROID_HOME")," environment variable, or in its successor - ",(0,i.kt)("inlineCode",{parentName:"p"},"ANDROID_SDK_ROOT"),". If ",(0,i.kt)("inlineCode",{parentName:"p"},"ANDROID_HOME")," isn\u2019t set, either set it yourself or run the following commands after ",(0,i.kt)("inlineCode",{parentName:"p"},"cd"),"-ing into the home folder.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Preliminary: Upgrade your ",(0,i.kt)("inlineCode",{parentName:"p"},"emulator")," executable to the latest version.\n",(0,i.kt)("em",{parentName:"p"},"Note: It is OK if the emulator\u2019s version is not aligned with the SDK or platform-tools' version you currently have installed (e.g. 30.x.x vs. SDK 29)")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ANDROID_HOME/tools/bin/sdkmanager --install emulator\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Install an emulator image without Google APIs:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'$ANDROID_HOME/tools/bin/sdkmanager "system-images;android-28;default;x86_64"\n$ANDROID_HOME/tools/bin/sdkmanager --licenses\n')),(0,i.kt)("blockquote",{parentName:"li"},(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},"With ",(0,i.kt)("inlineCode",{parentName:"li"},";android-28;"),", we assumed SDK 28 here, but other APIs are supported just the same."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},";default;")," part replaces ",(0,i.kt)("inlineCode",{parentName:"li"},";google_apis;"),", which is the default, and is what matters here.")))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create an emulator (i.e. AVD - Android Virtual Device):"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'$ANDROID_HOME/tools/bin/avdmanager create avd -n Pixel_API_28_AOSP -d pixel --package "system-images;android-28;default;x86_64"\n')),(0,i.kt)("blockquote",{parentName:"li"},(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Pixel_API_28_AOSP")," is just a suggestion for a name. Any name can work here, even ",(0,i.kt)("inlineCode",{parentName:"li"},"Pixel_API_28")," - but you might have to delete an existing non-AOSP emulator, first. In any case, the name used in Detox configuration (typically in ",(0,i.kt)("inlineCode",{parentName:"li"},"package.json"),") should be identical to this one."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-d pixel")," will install an emulator with the specs of a Pixel-1 device. Other specs can be used."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--package")," is the most important argument: be sure to use the same value as you did in part 2, above, with ",(0,i.kt)("inlineCode",{parentName:"li"},";default;"),".")),(0,i.kt)("p",{parentName:"blockquote"},"Run ",(0,i.kt)("inlineCode",{parentName:"p"},"avdmanager create --help")," for the full list of options."))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Launch the emulator:"))),(0,i.kt)("p",null,"This isn\u2019t mandatory, of course, but it\u2019s always good to launch the emulator at least once before running automated tests. The section below will discuss optimizing emulators bootstrapping."),(0,i.kt)("p",null,"At this point, you should be able to launch the emulator from Android Studio, but that can also be done from a command line console, as explained in the ",(0,i.kt)("a",{parentName:"p",href:"#locating-the-avds-home-directory"},"cheatsheet below"),"."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"See ",(0,i.kt)("a",{parentName:"p",href:"https://developer.android.com/studio/run/emulator-commandline"},"this guide")," for full details on the ",(0,i.kt)("inlineCode",{parentName:"p"},"emulator")," executable.")),(0,i.kt)("h3",{id:"installing-from-android-studio"},"Installing from Android Studio"),(0,i.kt)("p",null,"We won\u2019t go into all the details but once the proper image is installed using the ",(0,i.kt)("inlineCode",{parentName:"p"},"sdkmanager"),", the option becomes available in the AVD creation dialog  (see ",(0,i.kt)("inlineCode",{parentName:"p"},"Target")," column of the Virtual Device Configuration screen below):"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"SDK manager in AS",src:n(6059).Z})),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Install AOSP in AS",src:n(9403).Z})),(0,i.kt)("p",null,'Also, be sure to upgrade your emulator executable to the latest version: If it isn\u2019t up-to-date, you will get an "Update Available" message under the ',(0,i.kt)("em",{parentName:"p"},"status"),' column, instead of "Installed":'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Upgrade emulator in AS",src:n(9931).Z})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note:")," ",(0,i.kt)("em",{parentName:"p"},"It is OK if the emulator\u2019s version is not aligned with the SDK or platform-tools' version you currently have installed (e.g. 30.x.x vs. SDK 29)")),(0,i.kt)("h2",{id:"emulator-quick-boot"},"Emulator Quick-Boot"),(0,i.kt)("p",null,"If the system allows saving a state (for example, in personal computers or a CI system that can start from prebaked images you can configure), we highly and strongly recommend setting up quick-boot snapshots for any emulator that is used for testing automation."),(0,i.kt)("p",null,"Quick-boot saves significant time otherwise wasted when emulators cold-boot from scratch. The concept becomes more prominent in environments capable of parallel-executing tests in multiple, concurrently running emulators (as when ",(0,i.kt)("a",{parentName:"p",href:"/Detox/docs/guide/jest"},"Detox is run with multiple Jest workers"),")."),(0,i.kt)("p",null,"This is something that we actually recommend applying in the emulator itself rather than using command-line, but we\u2019ll include both options."),(0,i.kt)("p",null,"In any case, the general principle we\u2019re going to instruct is as follows:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Enable auto-save for an installed / running emulator."),(0,i.kt)("li",{parentName:"ol"},"Launch it, and, when stable, terminate -- a snapshot is saved as a result."),(0,i.kt)("li",{parentName:"ol"},"Disable auto-save, so that future, test-tainted snapshots won\u2019t be saved.")),(0,i.kt)("h3",{id:"setting-up-a-quick-boot-snapshot-from-the-emulator"},"Setting up a quick-boot snapshot from the Emulator"),(0,i.kt)("p",null,"Start by launching a freshly baked emulator. Wait for it to go stable."),(0,i.kt)("p",null,"When running, go to settings (3 dots in the sidebar) > ",(0,i.kt)("inlineCode",{parentName:"p"},"Snapshots")," > ",(0,i.kt)("inlineCode",{parentName:"p"},"Settings")," tab. If not already set, select ",(0,i.kt)("inlineCode",{parentName:"p"},"Yes")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"auto-save")," option. This should prompt for a restart -- choose ",(0,i.kt)("inlineCode",{parentName:"p"},"Yes"),". The emulator should restart ",(0,i.kt)("strong",{parentName:"p"},"and save a snapshot.")),(0,i.kt)("img",{src:"img/android/snapshot-autosave.png",alt:"Emulator auto-save menu"}),(0,i.kt)("p",null,"Do this again after the emulator is back up, but set ",(0,i.kt)("inlineCode",{parentName:"p"},"No")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"auto-save")," option. Allow it to restart yet again: it will immediately boot into the state saved as a snapshot earlier."),(0,i.kt)("p",null,"You can also try these as alternative sources for this:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://developer.android.com/studio/run/emulator#snapshots"},"Snapshots in Google Developers page")," for full details on snapshots."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://devblogs.microsoft.com/xamarin/android-emulator-quick-boot/"},"Highly detailed blog post"))),(0,i.kt)("h3",{id:"setting-up-a-quick-boot-snapshot-from-command-line"},"Setting up a quick-boot snapshot from command-line"),(0,i.kt)("p",null,"This is a bit more difficult, but is also applicable even for UI-less machines."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"#locating-the-avds-home-directory"},"Locate the AVD\u2019s ",(0,i.kt)("inlineCode",{parentName:"a"},"config.ini")))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Using your favorite text editor, either change or add these key-value sets:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ini"},"fastboot.chosenSnapshotFile=\nfastboot.forceChosenSnapshotBoot=no\nfastboot.forceColdBoot=no\nfastboot.forceFastBoot=yes\n")))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Empirically, ",(0,i.kt)("inlineCode",{parentName:"p"},"forceFastBoot=yes")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"forceColdBoot=no")," should be enough.")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Under the AVD\u2019s home directory, either create or edit yet another ",(0,i.kt)("inlineCode",{parentName:"p"},"ini")," file called ",(0,i.kt)("inlineCode",{parentName:"p"},"quickbootChoice.ini")," with the following content:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ini"},"saveOnExit = true\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Now that everything is in place, ",(0,i.kt)("a",{parentName:"p",href:"#booting-an-emulator-via-command-line"},"launch your emulator")," once (in verbose mode) and wait for it to fully load. Then, shut it down, and make sure the ",(0,i.kt)("a",{parentName:"p",href:"#verifying-the-emulators-quick-boot-snapshot-has-been-saved"},"state has been saved"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Last but not least, go back to ",(0,i.kt)("inlineCode",{parentName:"p"},"quickbootChoice.ini")," and now switch to:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-ini"},"saveOnExit = false\n")))),(0,i.kt)("h3",{id:"disclaimer"},"Disclaimer"),(0,i.kt)("p",null,"After upgrading the emulator\u2019s binary to a newer version, it usually considers all existing snapshots invalid."),(0,i.kt)("p",null,"This can be addressed by deleting and recreating the snapshots as explained, or by recreating the AVD\u2019s altogether."),(0,i.kt)("h2",{id:"cheatsheet"},"Cheatsheet"),(0,i.kt)("h3",{id:"locating-the-avds-home-directory"},"Locating the AVD\u2019s home directory"),(0,i.kt)("p",null,"Each AVD generated by the Android tools gets its own directory where associated content is stored:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Configuration file (i.e. ",(0,i.kt)("inlineCode",{parentName:"strong"},"config.ini"),")")),(0,i.kt)("li",{parentName:"ul"},"Snapshot images"),(0,i.kt)("li",{parentName:"ul"},"SD-card content")),(0,i.kt)("p",null,"to name a few."),(0,i.kt)("p",null,"On Mac machines, the AVD directory typically maps to:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$HOME/.android/avd/<AVD Name>.avd/\n")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"(for example: ",(0,i.kt)("inlineCode",{parentName:"em"},"/Users/root/.android/avd/Pixel_API_28_AOSP.avd/"),")")),(0,i.kt)("p",null,"The path should be similar on Linux machines, even though ",(0,i.kt)("inlineCode",{parentName:"p"},"$HOME")," isn\u2019t ",(0,i.kt)("inlineCode",{parentName:"p"},"/Users/root")," but typically ",(0,i.kt)("inlineCode",{parentName:"p"},"/home/root")," ",(0,i.kt)("em",{parentName:"p"},"(for example: ",(0,i.kt)("inlineCode",{parentName:"em"},"/home/root/.android/avd/Pixel_API_28_AOSP.avd/"),").")),(0,i.kt)("h3",{id:"booting-an-emulator-via-command-line"},"Booting an emulator via command-line"),(0,i.kt)("blockquote",null,(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},"The following examples apply for both Mac and Linux, and should be similar on Windows."),(0,i.kt)("li",{parentName:"ul"},"They assume the emulator\u2019s name is ",(0,i.kt)("inlineCode",{parentName:"li"},"Pixel_API_28_AOSP"),". If it isn\u2019t, adjust the names accordingly:"))),(0,i.kt)("h4",{id:"shortcut-for-booting-a-verbose-visible-emulator-in-a-gui-supporting-system"},"Shortcut for booting a verbose, visible emulator in a GUI supporting system"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ANDROID_HOME/emulator/emulator -verbose @Pixel_API_28_AOSP &\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Shortcut for booting a verbose, ",(0,i.kt)("em",{parentName:"strong"},"headless")," emulator in a UI-less Linux system")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ANDROID_HOME/emulator/emulator -verbose -no-window -no-audio -gpu swiftshader_indirect @Pixel_API_28_AOSP &\n")),(0,i.kt)("h3",{id:"verifying-the-emulators-quick-boot-snapshot-has-been-saved"},"Verifying the emulator\u2019s quick-boot snapshot has been saved"),(0,i.kt)("p",null,"If you\u2019ve run your emulator in verbose mode from a shell, it\u2019s easy to verify the state has been saved by following the logs. In particular, when shutting the emulator down, this log asserts the state has been saved:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"emulator: Saving state on exit with session uptime 9423 ms\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"as a reference, when the state is ",(0,i.kt)("em",{parentName:"p"},"not")," saved, the typical output is:"),(0,i.kt)("pre",{parentName:"blockquote"},(0,i.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"emulator: WARNING: Not saving state: RAM not mapped as shared\n")),(0,i.kt)("p",{parentName:"blockquote"},"It can be a result of an improper configuration, or an emulator launch where the ",(0,i.kt)("inlineCode",{parentName:"p"},"-read-only")," argument was provided.")))}u.isMDXComponent=!0},6059:function(e,t,n){t.Z=n.p+"assets/images/aosp-image-as-37ababd9a7fb486a0bde4055e29cee14.png"},9403:function(e,t,n){t.Z=n.p+"assets/images/install-aosp-as-487bc180542ec85812f0b6042f1ee67a.png"},9931:function(e,t,n){t.Z=n.p+"assets/images/upgrade-emulator-as-6b05bdb7dd36d8c4ddb3f37bef9fbe1f.png"}}]);