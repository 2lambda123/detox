"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5495],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=o.createContext({}),l=function(e){var t=o.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=l(e.components);return o.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,u=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=l(n),g=a,m=c["".concat(u,".").concat(g)]||c[g]||d[g]||i;return n?o.createElement(m,r(r({ref:t},p),{},{components:n})):o.createElement(m,r({ref:t},p))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=c;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var l=2;l<i;l++)r[l]=n[l];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},8579:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var o=n(7462),a=(n(7294),n(3905));const i={id:"debugging-in-xcode",slug:"guide/debugging-in-xcode",title:"Debugging in Xcode During Detox Tests",sidebar_label:"Debugging in Xcode During Detox Tests"},r=void 0,s={unversionedId:"debugging-in-xcode",id:"debugging-in-xcode",title:"Debugging in Xcode During Detox Tests",description:"Debugging in Xcode During Detox Tests",source:"@site/../docs/Guide.DebuggingInXcode.md",sourceDirName:".",slug:"/guide/debugging-in-xcode",permalink:"/Detox/docs/next/guide/debugging-in-xcode",draft:!1,editUrl:"https://github.com/wix/Detox/edit/master/docs/../docs/Guide.DebuggingInXcode.md",tags:[],version:"current",frontMatter:{id:"debugging-in-xcode",slug:"guide/debugging-in-xcode",title:"Debugging in Xcode During Detox Tests",sidebar_label:"Debugging in Xcode During Detox Tests"},sidebar:"tutorialSidebar",previous:{title:"Running on CI",permalink:"/Detox/docs/next/guide/running-on-ci"},next:{title:"Debugging in Android Studio",permalink:"/Detox/docs/next/guide/debugging-in-android-studio"}},u={},l=[{value:"Debugging in Xcode During Detox Tests",id:"debugging-in-xcode-during-detox-tests",level:2},{value:"Add Detox Framework to Your Project",id:"add-detox-framework-to-your-project",level:3},{value:"Add a &quot;manual&quot; configuration to your <code>.detoxrc</code>",id:"add-a-manual-configuration-to-your-detoxrc",level:3},{value:"Run a specific test",id:"run-a-specific-test",level:3},{value:"Launching the app",id:"launching-the-app",level:3}],p={toc:l};function d(e){let{components:t,...i}=e;return(0,a.kt)("wrapper",(0,o.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"debugging-in-xcode-during-detox-tests"},"Debugging in Xcode During Detox Tests"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"This is mostly useful for investigating weird crashes or when contributing to Detox itself. ",(0,a.kt)("strong",{parentName:"p"},"This workflow isn\u2019t standard. Don\u2019t use it unless you have a good reason."))),(0,a.kt)("h3",{id:"add-detox-framework-to-your-project"},"Add Detox Framework to Your Project"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Go to ",(0,a.kt)("inlineCode",{parentName:"p"},"node_modules/detox")," and extract ",(0,a.kt)("inlineCode",{parentName:"p"},"Detox-ios-src.tbz")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("img",{alt:"extracted detox-ios-src directory",src:n(5824).Z,width:"817",height:"460"}))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Drag ",(0,a.kt)("inlineCode",{parentName:"p"},"Detox-ios-src/Detox.xcodeproj")," into your Xcode project"),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("img",{alt:"Detox inside Xcode project",src:n(3901).Z,width:"269",height:"284"}))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Go to your project settings \u2192 ",(0,a.kt)("strong",{parentName:"p"},"General")," and add ",(0,a.kt)("strong",{parentName:"p"},"Detox.framework")," to ",(0,a.kt)("strong",{parentName:"p"},"Frameworks, Libraries, and Embedded Content")," (make sure ",(0,a.kt)("strong",{parentName:"p"},"Embed & Sign")," is selected under ",(0,a.kt)("strong",{parentName:"p"},"Embed"),")"),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("img",{alt:"embed Detox",src:n(2975).Z,width:"675",height:"230"})))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"NOTE: Apps should not be submitted to the App Store with the Detox framework linked. Follow this guide only to debug Detox issues in your project. Once finished, make sure to remove ",(0,a.kt)("strong",{parentName:"p"},"Detox.framework")," from your project.")),(0,a.kt)("h3",{id:"add-a-manual-configuration-to-your-detoxrc"},'Add a "manual" configuration to your ',(0,a.kt)("inlineCode",{parentName:"h3"},".detoxrc")),(0,a.kt)("p",null,"Locate your ",(0,a.kt)("inlineCode",{parentName:"p"},".detoxrc")," config file or the corresponding ",(0,a.kt)("inlineCode",{parentName:"p"},"detox")," section in your ",(0,a.kt)("inlineCode",{parentName:"p"},"package.json"),"\nand add a configuration similar to this one:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "devices": {\n    "simulator": {\n      "type": "ios.simulator",\n      "device": {\n        "type": "<e.g., iPhone 12 Pro>"\n      }\n    }\n  },\n  "apps": {\n    "ios.debug": {\n      "type": "ios.app",\n      "binaryPath": "<path to your app binary built before>"\n    }\n  },\n  "configurations": {\n    "ios.manual": {\n      "device": "simulator",\n      "app": "ios.debug",\n      "behavior": {\n        "launchApp": "manual"\n      }\n    }\n  }\n}\n')),(0,a.kt)("p",null,"While the ",(0,a.kt)("inlineCode",{parentName:"p"},"behavior")," section is a ",(0,a.kt)("strong",{parentName:"p"},"mandatory")," thing to include, there are a few more optional\nparameters to disable various side effects and make life easier when debugging:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},'   "behavior": {\n     "launchApp": "manual"\n   },\n+  "session": {\n+    "autoStart": true,\n+    "debugSynchronization": 0,\n+    "server": "ws://localhost:8099",\n+    "sessionId": "test"\n+  },\n+  "artifacts": false\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Using a preconfigured ",(0,a.kt)("inlineCode",{parentName:"p"},"session")," with an autostarting server removes the legwork of copying and\npasting values to the instrumentation runner launch arguments dialog every time before any launch\nfrom the IDE. Otherwise, by default when the ",(0,a.kt)("inlineCode",{parentName:"p"},"session")," object omitted, ",(0,a.kt)("inlineCode",{parentName:"p"},"server")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"sessionId"),"\nare randomly generated for every new test session."),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"debugSynchronization: 0")," override matters only if you have a global ",(0,a.kt)("inlineCode",{parentName:"li"},"session")," config\nwith ",(0,a.kt)("inlineCode",{parentName:"li"},"debugSynchronization")," set to a positive integer value. Otherwise, it is not needed. The point\nis to disable regular app polling requests during debugging, since that only can hinder the debugging."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Setting ",(0,a.kt)("inlineCode",{parentName:"p"},"artifacts: false")," override also matters only if you have a global ",(0,a.kt)("inlineCode",{parentName:"p"},"artifacts")," config.\nThe motivation is to disable irrelevant taxing activities on the device such as capturing logs\nscreenshots, videos and so on."),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"If your investigation addresses a specific artifact plugin glitch on the native side, then just\ndisable all the other plugins. See ",(0,a.kt)("a",{parentName:"li",href:"/Detox/docs/next/api/configuration"},"Detox Configuration")," document\nfor the reference.")))),(0,a.kt)("h3",{id:"run-a-specific-test"},"Run a specific test"),(0,a.kt)("p",null,"Usually, you would want to focus on a specific test suite to save time, e.g.:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"detox test -c ios.manual e2e/someSuite.test.js --testTimeout 999999\n")),(0,a.kt)("p",null,"Forwarding an increased ",(0,a.kt)("inlineCode",{parentName:"p"},"testTimeout")," to Jest (as shown below) is recommended to avoid false timeout errors\nwhich are likely to be thrown if you spend too much time in debugging."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Also, if there is something you want to do step by step in JS code while debugging native, append\n",(0,a.kt)("inlineCode",{parentName:"p"},"--inspect-brk")," flag:"),(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"detox test -c ios.manual e2e/someSuite.test.js --inspect-brk\n")),(0,a.kt)("p",{parentName:"blockquote"},"To learn more about debugging with ",(0,a.kt)("inlineCode",{parentName:"p"},"--inspect-brk"),", refer to\n",(0,a.kt)("a",{parentName:"p",href:"https://nodejs.org/en/docs/guides/debugging-getting-started/"},"Debugging \u2014 Getting Started"),"\non the official Node.js website.")),(0,a.kt)("p",null,"Afterwards, you should see your test suite starting as usual until it reaches the app launch, where\nDetox stops instead and prompts you to launch the app from the IDE:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"detox[16804] INFO:  [SimulatorDriver.js] Waiting for you to manually launch your app in Xcode.\nMake sure to pass the launch arguments listed below:\n  -detoxServer ws://localhost:8099\n  -detoxSessionId com.wix.detox-example\n\nPress any key to continue...\n")),(0,a.kt)("p",null,"You\u2019ll need to run your app with the said arguments from Xcode:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Xcode - Edit Schema - Arguments tab",src:n(3518).Z,width:"897",height:"505"})),(0,a.kt)("h3",{id:"launching-the-app"},"Launching the app"),(0,a.kt)("p",null,"Before you launch the app, make sure to ",(0,a.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/xcode/setting-breakpoints-to-pause-your-running-app"},"put breakpoints")," at the points of interest, e.g.:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"put a breakpoint in the native code",src:n(7238).Z,width:"457",height:"88"})),(0,a.kt)("p",null,"Launch the app with the debugger attached:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"launching the app",src:n(2582).Z,width:"420",height:"882"})),(0,a.kt)("p",null,"The moment you see the app is idle, go back to the Terminal where Detox is running\nand press any key. If you wish to terminate the process for some reason, use Ctrl+C.\nIn a couple of seconds you are expected to see a confirmation from Detox, e.g.:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"Found the app (com.wix.detox-example) with process ID = 16854. Proceeding...\n")),(0,a.kt)("p",null,"Now the entire test will run as usual until it sends an action to the app, which gets trapped\nin your breakpoint. Now, when you are there, we wish you happy debugging!"))}d.isMDXComponent=!0},3901:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/drag-src-to-project-31530917b943a4034be35eaa96cf2379.png"},3518:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/edit-schema-arguments-046e78ab9badb56d7e860e6412d47ec1.png"},2975:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/embed-detox-project-13a3184c5b6f136a0537b8c2fc57347b.png"},5824:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/extracted-ios-src-ae12bd6e062f06e7e7e1f41e3746edd9.png"},2582:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/launch-app-with-debugger-b16ad3d8e537e0bfe0b5e007489db914.png"},7238:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/putting-a-breakpoint-d12086f5097b61ba8c10fb8caab3f574.png"}}]);