"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1222],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(n),h=a,m=u["".concat(s,".").concat(h)]||u[h]||d[h]||r;return n?i.createElement(m,l(l({ref:t},c),{},{components:n})):i.createElement(m,l({ref:t},c))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,l=new Array(r);l[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var p=2;p<r;p++)l[p]=n[p];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6961:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var i=n(7462),a=(n(7294),n(3905));const r={},l="Internals",o={unversionedId:"api/internals",id:"api/internals",title:"Internals",description:"This section might be more volatile than the other ones, yet we'll do our",source:"@site/../docs/api/internals.md",sourceDirName:"api",slug:"/api/internals",permalink:"/Detox/docs/next/api/internals",draft:!1,editUrl:"https://github.com/wix/Detox/edit/master/docs/../docs/api/internals.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Logger",permalink:"/Detox/docs/next/api/logger"},next:{title:"Dealing With Problems With Building the App & Detox",permalink:"/Detox/docs/next/troubleshooting/building-the-app"}},s={},p=[{value:"Main lifecycle",id:"main-lifecycle",level:2},{value:"<code>resolveConfig</code>",id:"resolveconfig",level:3},{value:"<code>getStatus</code>",id:"getstatus",level:3},{value:"<code>init</code>",id:"init",level:3},{value:"<code>cleanup</code>",id:"cleanup",level:3},{value:"<code>installWorker</code>",id:"installworker",level:3},{value:"<code>uninstallWorker</code>",id:"uninstallworker",level:3},{value:"Optional lifecycle",id:"optional-lifecycle",level:2},{value:"Synchronizing with artifacts manager",id:"synchronizing-with-artifacts-manager",level:3},{value:"Reporting failed tests",id:"reporting-failed-tests",level:3},{value:"Properties",id:"properties",level:2},{value:"config",id:"config",level:3},{value:"session",id:"session",level:3},{value:"log",id:"log",level:3},{value:"<code>tracing</code>",id:"tracing",level:3},{value:"worker",id:"worker",level:3}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"internals"},"Internals"),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"This section might be more volatile than the other ones, yet we'll do our\nbest to adhere to Semantic Release standards even here.")),(0,a.kt)("p",null,"Detox Internals might be useful for developing advanced enterprise presets\nor if you are planning to integrate with a third-party test runner like\n",(0,a.kt)("a",{parentName:"p",href:"https://mochajs.org"},"Mocha"),", ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/avajs/ava"},"Ava"),", ",(0,a.kt)("a",{parentName:"p",href:"https://vitest.dev"},"Vitest")," or other ones."),(0,a.kt)("h2",{id:"main-lifecycle"},"Main lifecycle"),(0,a.kt)("h3",{id:"resolveconfig"},(0,a.kt)("inlineCode",{parentName:"h3"},"resolveConfig")),(0,a.kt)("p",null,"Use with a caution, when you still have no config, yet need to avoid ","[","internals.init()]","[","#init] call."),(0,a.kt)("p",null,"You normally don\u2019t need it if you use Detox CLI (",(0,a.kt)("inlineCode",{parentName:"p"},"detox test \u2026"),"), but if you want to start tests\ndirectly and you need to have the config resolved before ","[","internals.init()]","[","#init] is called, this\nis the way to go."),(0,a.kt)("h3",{id:"getstatus"},(0,a.kt)("inlineCode",{parentName:"h3"},"getStatus")),(0,a.kt)("p",null,"Returns a string (",(0,a.kt)("inlineCode",{parentName:"p"},"inactive"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"init"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"active")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"cleanup"),") depending on what\u2019s going on."),(0,a.kt)("h3",{id:"init"},(0,a.kt)("inlineCode",{parentName:"h3"},"init")),(0,a.kt)("p",null,"This is the phase where Detox reads its configuration, starts a server."),(0,a.kt)("h3",{id:"cleanup"},(0,a.kt)("inlineCode",{parentName:"h3"},"cleanup")),(0,a.kt)("p",null,"The global cleanup phase should happen after all the tests have finished.\nThis is the phase where the Detox server shuts down."),(0,a.kt)("h3",{id:"installworker"},(0,a.kt)("inlineCode",{parentName:"h3"},"installWorker")),(0,a.kt)("p",null,"This is the phase where Detox loads its expectation library and starts a device."),(0,a.kt)("h3",{id:"uninstallworker"},(0,a.kt)("inlineCode",{parentName:"h3"},"uninstallWorker")),(0,a.kt)("p",null,"Deallocates the device."),(0,a.kt)("h2",{id:"optional-lifecycle"},"Optional lifecycle"),(0,a.kt)("h3",{id:"synchronizing-with-artifacts-manager"},"Synchronizing with artifacts manager"),(0,a.kt)("p",null,"The naming you can see adheres much to Jest Circus workflow:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onRunStart")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onRunDescribeStart")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onTestStart")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onHookStart")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onHookFailure")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onHookSuccess")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onTestFnStart")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onTestFnFailure")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onTestFnSuccess")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onTestDone")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onRunDescribeFinish")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"onRunFinish"))),(0,a.kt)("h3",{id:"reporting-failed-tests"},"Reporting failed tests"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"reportFailedTests")," reports to Detox CLI about failed tests that could\nhave been re-run if ",(0,a.kt)("inlineCode",{parentName:"p"},"--retries")," is set to a non-zero."),(0,a.kt)("p",null,"It takes two arguments:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"testFilePaths")," \u2013 array of failed test files' paths"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"permanent")," \u2013 whether the failure is permanent, and the tests should not be re-run."),(0,a.kt)("li",{parentName:"ul"},"returns a promise.")),(0,a.kt)("h2",{id:"properties"},"Properties"),(0,a.kt)("h3",{id:"config"},"config"),(0,a.kt)("h3",{id:"session"},"session"),(0,a.kt)("h3",{id:"log"},"log"),(0,a.kt)("h3",{id:"tracing"},(0,a.kt)("inlineCode",{parentName:"h3"},"tracing")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"tracing.createEventStream()")," \u2013 creates a readable stream of the currently recorded events in\n",(0,a.kt)("a",{parentName:"p",href:"https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU"},"Chrome Trace Event format"),"."),(0,a.kt)("p",null,"See also: ",(0,a.kt)("a",{parentName:"p",href:"https://wix-incubator.github.io/trace-event-lib/interfaces/DurationBeginEvent.html"},(0,a.kt)("inlineCode",{parentName:"a"},"DurationBeginEvent")),", ",(0,a.kt)("a",{parentName:"p",href:"https://wix-incubator.github.io/trace-event-lib/interfaces/DurationEndEvent.html"},(0,a.kt)("inlineCode",{parentName:"a"},"DurationEndEvent")),", ",(0,a.kt)("a",{parentName:"p",href:"https://wix-incubator.github.io/trace-event-lib/interfaces/InstantEvent.html"},(0,a.kt)("inlineCode",{parentName:"a"},"InstantEvent")),"."),(0,a.kt)("h3",{id:"worker"},"worker"),(0,a.kt)("p",null,"Not documented on purpose. Provides the direct access to the object which\nholds the device driver, websocket client, matchers, expectations, etc."))}d.isMDXComponent=!0}}]);