"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7477],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(n),h=o,d=c["".concat(l,".").concat(h)]||c[h]||m[h]||a;return n?r.createElement(d,i(i({ref:t},p),{},{components:n})):r.createElement(d,i({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},910:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var r=n(7462),o=(n(7294),n(3905));const a={authors:["noomorph"],tags:["major-release","genymotion"]},i="Detox 20 is out",s={permalink:"/Detox/blog/detox-20-is-out",editUrl:"https://github.com/wix/Detox/edit/master/website/blog/detox-20-is-out.md",source:"@site/blog/detox-20-is-out.md",title:"Detox 20 is out",description:"This is a draft post about a future release.",date:"2022-10-04T12:04:35.000Z",formattedDate:"October 4, 2022",tags:[{label:"major-release",permalink:"/Detox/blog/tags/major-release"},{label:"genymotion",permalink:"/Detox/blog/tags/genymotion"}],readingTime:3.915,hasTruncateMarker:!1,authors:[{name:"Yaroslav Serhieiev",title:"Detox Core Contributor",url:"https://github.com/noomorph",imageURL:"https://github.com/noomorph.png",key:"noomorph"}],frontMatter:{authors:["noomorph"],tags:["major-release","genymotion"]}},l={authorsImageUrls:[void 0]},u=[{value:"Integration with test runners",id:"integration-with-test-runners",level:2},{value:"Genymotion SaaS",id:"genymotion-saas",level:2},{value:"Configurable logger",id:"configurable-logger",level:2},{value:"Minor features",id:"minor-features",level:2},{value:"Afterword",id:"afterword",level:2}],p={toc:u};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"This is a draft post about a future release.\nCongrats if you found it earlier than we announced it.")),(0,o.kt)("p",null,"Today we're proud to announce the new major release, ",(0,o.kt)("strong",{parentName:"p"},"Detox 20"),", which brings:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"improved integration with test runners,"),(0,o.kt)("li",{parentName:"ul"},"official support for Genymotion SaaS,"),(0,o.kt)("li",{parentName:"ul"},"configurable logging subsystem,"),(0,o.kt)("li",{parentName:"ul"},"a few convenience features (",(0,o.kt)("inlineCode",{parentName:"li"},"headless")," for iOS, ",(0,o.kt)("inlineCode",{parentName:"li"},"reversePorts")," for Android),"),(0,o.kt)("li",{parentName:"ul"},"and more optimizations to land in the next minor versions.")),(0,o.kt)("h2",{id:"integration-with-test-runners"},"Integration with test runners"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Highlights"),": ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/config/testRunner"},(0,o.kt)("inlineCode",{parentName:"a"},"Config file > Test runner")),", ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/api/internals"},(0,o.kt)("inlineCode",{parentName:"a"},"Internals API")),", ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/issues/3193"},(0,o.kt)("inlineCode",{parentName:"a"},"Dropping Mocha support")),"."),(0,o.kt)("p",null,"It took about a few months of work to formalize the contract between Detox and a test runner. While there's still a lot of place for improvement, the new Detox release refines their interaction and lays the groundwork for third-party integrations."),(0,o.kt)("p",null,"Mocha was our first supported test runner, but unfortunately, it could not keep up with our scaling requirements as the number of end-to-end tests grew. ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/mochajs/mocha/releases/tag/v8.0.0"},"By the time")," it acquired the ability to run tests in parallel, we already had ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/pull/609"},"to place bets")," on the next horse, Jest."),(0,o.kt)("p",null,"We attempted to keep compatibility with both Jest and Mocha, but the farther we went, the more obvious it was that we couldn't have it both ways. As it turned out, Jest wasn't easy to get along with \u2013 our first integration with it was too simplistic. Over a couple of years of use in production, we kept discovering various issues that forced us to rewrite our \"glue\" code from scratch twice, and this isn't over yet. All that combined didn't leave much time and energy for tinkering with Mocha again."),(0,o.kt)("p",null,"The new Detox release brings such improvements as ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/config/testRunner"},"test runner config")," and ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/api/internals"},"Internals API"),". However, in this transition, we had to leave behind our old Mocha integration due to a shortage of resources. If there's enough demand, it is up to the open-source community to build it."),(0,o.kt)("h2",{id:"genymotion-saas"},"Genymotion SaaS"),(0,o.kt)("p",null,"TODO: Genymotion SaaS"),(0,o.kt)("h2",{id:"configurable-logger"},"Configurable logger"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Highlights"),": ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/config/logger"},(0,o.kt)("inlineCode",{parentName:"a"},"Config file > Logger")),", ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/api/logger"},(0,o.kt)("inlineCode",{parentName:"a"},"Logger API")),"."),(0,o.kt)("p",null,"The rigidity of the logging subsystem has been weighing on me ever ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/pull/835"},"since I rewrote it")," in the summer of 2019. Due to time constraints and subpar test runner integrations, it was impossible to do it right the first time, so we lived about three years with tech debt."),(0,o.kt)("p",null,"The problem wasn't fatal but quite discomforting, nevertheless. Here are a few examples you could have noticed if you have ever used Detox timeline and log artifacts, especially when running tests in parallel:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"an uncanny file array: ",(0,o.kt)("inlineCode",{parentName:"li"},"detox_pid_7505.log"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"detox_pid_7505.log.json"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"detox_pid_7506.log"),";"),(0,o.kt)("li",{parentName:"ul"},"a relatively shallow ",(0,o.kt)("inlineCode",{parentName:"li"},"detox.trace.json"),": test suites, test functions, and some user-defined segments.")),(0,o.kt)("p",null,"The new release condenses all those numerous Detox logs into two files:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"the plain, human-readable ",(0,o.kt)("inlineCode",{parentName:"li"},"detox.log"),";"),(0,o.kt)("li",{parentName:"ul"},"the raw, machine-readable ",(0,o.kt)("inlineCode",{parentName:"li"},"detox.trace.json")," for Perfetto, Chrome Trace, and other programs.")),(0,o.kt)("p",null,"[","here be the screenshot]"),(0,o.kt)("p",null,"It becomes possible now to customize the console output of Detox too:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="detox.config.js"',title:'"detox.config.js"'},"/** @type {Detox.DetoxConfig} */\nmodule.exports = {\n  // ...\n  logger: {\n    showDate: false,\n    showProcess: false,\n  },\n};\n")),(0,o.kt)("p",null,"[","here be the screenshot]"),(0,o.kt)("h2",{id:"minor-features"},"Minor features"),(0,o.kt)("p",null,"TODO: Minor features"),(0,o.kt)("h2",{id:"afterword"},"Afterword"),(0,o.kt)("p",null,"Over the last year and a half, we have been establishing a centralized configuration system for more than 50 projects using Detox at Wix. While it never seemed to be a cakewalk, the entire experience of troubleshooting over a hundred issues across the organization did not leave us the same."),(0,o.kt)("p",null,"We clearly see there are numerous things to improve in Detox, but most of them boil down to the same thing \u2013 ",(0,o.kt)("strong",{parentName:"p"},"scaling"),'. Surprisingly, "scaling" makes an excellent umbrella term for nearly every challenge we\'ve been encountering lately:'),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"scaling up the users count")," requires us to improve the onboarding and troubleshooting experience;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"scaling up the projects count")," forces us to centralize scattered configs into flexible organization presets;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"scaling up the tests count")," prompts us to optimize the codebase and incline it towards cloud and remote execution.")),(0,o.kt)("p",null,"Our core team has been challenged with human resource constraints and scaling needs for a long time already, and, in many ways, that has shaped a specific mindset within our core team, where every feature is evaluated via asking a simple question: ",(0,o.kt)("em",{parentName:"p"},"is it going to save us and other people time to focus on more important things?")," Teaching how to fish is better than giving a fish, and our success at preventing support issues is more valuable than our success at solving them ourselves."),(0,o.kt)("p",null,"This is why the upcoming releases will be aimed at..."))}m.isMDXComponent=!0}}]);