<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="search" type="application/opensearchdescription+xml" title="Detox" href="/Detox/opensearch.xml"><title data-react-helmet="true">Jest Setup Guide | Detox</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wix.github.io/Detox/docs/guide/jest"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Jest Setup Guide | Detox"><meta data-react-helmet="true" name="description" content="Jest Setup Guide"><meta data-react-helmet="true" property="og:description" content="Jest Setup Guide"><link data-react-helmet="true" rel="shortcut icon" href="/Detox/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wix.github.io/Detox/docs/guide/jest"><link data-react-helmet="true" rel="alternate" href="https://wix.github.io/Detox/docs/guide/jest" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wix.github.io/Detox/docs/guide/jest" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/Detox/assets/css/styles.c8787d8d.css">
<link rel="preload" href="/Detox/assets/js/runtime~main.841fd8d4.js" as="script">
<link rel="preload" href="/Detox/assets/js/main.866b3762.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Detox/"><div class="navbar__logo"><img src="/Detox/img/logo.png" alt="Detox Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/Detox/img/logo.png" alt="Detox Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Detox</b></a><a class="navbar__item navbar__link navbar__link--active" href="/Detox/docs/introduction/getting-started">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wix/Detox" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Bc3W"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Troubleshooting</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/running-locally">Running Locally</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/developing-while-writing-tests">Developing Your App While Writing Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/running-on-ci">Running on CI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/debugging-in-xcode">Debugging in Xcode During Detox Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/debugging-in-android-studio">Debugging in Android Studio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/mocking">Mocking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/migration">Migration Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Detox/docs/guide/jest">Jest Setup Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/mocha">Mocha Setup Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/parallel-test-execution">Parallel Test Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/third-party-drivers">Third-Party Drivers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/expo">Expo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/guide/uninstalling">Uninstalling Detox</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Detox/docs/contributing">Contributing</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Jest Setup Guide</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="jest-setup-guide">Jest Setup Guide<a aria-hidden="true" class="hash-link" href="#jest-setup-guide" title="Direct link to heading">â€‹</a></h2><blockquote><p><strong>NOTE: This article previously focused on deprecated <code>jest-jasmine2</code> runner setup, and if you nevertheless need to access it, <a href="https://github.com/wix/Detox/blob/ef466822129a4befcda71111d02b1a334539889b/docs/Guide.Jest.md" target="_blank" rel="noopener noreferrer">follow this Git history link</a>.</strong></p></blockquote><p>This guide describes how to install <a href="https://jestjs.io" target="_blank" rel="noopener noreferrer">Jest</a> as a test runner to be used by Detox for running the E2E tests.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="introduction">Introduction<a aria-hidden="true" class="hash-link" href="#introduction" title="Direct link to heading">â€‹</a></h3><p>As already mentioned in the <a href="/Detox/docs/introduction/getting-started#set-up-a-test-runner">Getting Started</a> guide, Detox itself does not effectively run tests logic, but rather delegates that responsibility onto a test runner. At the moment, Jest is the only recommended choice, for many reasons, including - but not limited to, parallel test suite execution capability, and complete integration with Detox API.</p><p>By the way, Jest itself â€” much like Detox, also does not effectively run any tests. Instead, it is more of a dispatcher and orchestrator of multiple instances of a delegated runner capable of running in parallel. For more info, refer to <a href="https://youtu.be/3YDiloj8_d0?t=2127" target="_blank" rel="noopener noreferrer">this video</a> (source: <a href="https://jestjs.io/docs/en/architecture" target="_blank" rel="noopener noreferrer">Jest architecture</a>).</p><p>For its part, Detox supports only one Jestâ€™s concrete runner, which is <a href="https://www.npmjs.com/package/jest-circus" target="_blank" rel="noopener noreferrer"><code>jest-circus</code></a> (<a href="https://jestjs.io/blog/2021/05/25/jest-27" target="_blank" rel="noopener noreferrer">ships by default with Jest since 27.0.0</a>). The former runner, <code>jest-jasmine2</code>, is deprecated due to specific bugs in the past, and architectural limitations at present.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="installation">Installation<a aria-hidden="true" class="hash-link" href="#installation" title="Direct link to heading">â€‹</a></h3><p><strong>Disclaimer:</strong></p><ol><li>Here we focus on installing Detox on <em>new projects</em>. If youâ€™re migrating a project with an existing Detox installation, please apply some common sense while using this guide.</li><li>These instructions are relevant for <code>jest@^27.0.0</code> (and <code>jest@^26.0.1 + jest-circus@^26.0.1</code>). They should likely work for the newer <code>jest</code> versions too, but for <strong>the older ones</strong> (25.x, 24.x) â€” <strong>they will not, due to blocking issues.</strong></li></ol><h4 class="anchor anchorWithStickyNavbar_y2LR" id="1-install-jest">1. Install Jest<a aria-hidden="true" class="hash-link" href="#1-install-jest" title="Direct link to heading">â€‹</a></h4><p>Before starting with Jest setup, be sure to complete the preliminary sections of the <a href="/Detox/docs/introduction/getting-started">Getting Started</a> guide.</p><p>Afterward, install the respective npm packages:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">npm install -D jest</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="2-set-up-test-code-scaffolds">2. Set up Test-code Scaffolds<a aria-hidden="true" class="hash-link" href="#2-set-up-test-code-scaffolds" title="Direct link to heading">â€‹</a></h4><p>Run the automated init script:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">detox init -r jest</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong> errors occurring in the process may appear in red.</p></blockquote><p>If things go well, the following will be created:</p><ul><li>An <code>e2e/</code> folder in your project root</li><li>An <code>e2e/config.json</code> file; <a href="https://github.com/wix/Detox/tree/master/examples/demo-react-native-jest/e2e/config.json" target="_blank" rel="noopener noreferrer">example</a></li><li>An <code>e2e/environment.js</code> file; <a href="https://github.com/wix/Detox/tree/master/examples/demo-react-native-jest/e2e/environment.js" target="_blank" rel="noopener noreferrer">example</a></li><li>An <code>e2e/firstTest.e2e.js</code> file with content similar to <a href="https://github.com/wix/Detox/tree/master/examples/demo-react-native-jest/e2e/app-hello.e2e.ts" target="_blank" rel="noopener noreferrer">this</a>.</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="3-fix--verify">3. Fix / Verify<a aria-hidden="true" class="hash-link" href="#3-fix--verify" title="Direct link to heading">â€‹</a></h4><p>Even if <code>detox init</code> passes well, and everything is green, we still recommend going over the checklist below. You can also use our example project, <a href="https://github.com/wix/Detox/tree/master/examples/demo-react-native-jest" target="_blank" rel="noopener noreferrer"><code>demo-react-native-jest</code></a>, as a reference in case of ambiguities.</p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="detoxrcjson">.detoxrc.json<a aria-hidden="true" class="hash-link" href="#detoxrcjson" title="Direct link to heading">â€‹</a></h5><table><thead><tr><th>Property</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>testRunner</code></td><td><code>&quot;jest&quot;</code></td><td><em>Required.</em> Should be <code>&quot;jest&quot;</code> for the proper <code>detox test</code> CLI functioning.</td></tr><tr><td><code>runnerConfig</code></td><td>(optional path to Jest config file)</td><td><em>Optional.</em> This field tells <code>detox test</code> CLI where to look for Jestâ€™s config file. If omitted, the default value is <code>e2e/config.json</code>.</td></tr><tr><td><code>skipLegacyWorkersInjection</code></td><td><code>false</code> or <code>true</code></td><td><em>Optional.</em> This field tells <code>detox test</code> to stop appending <code>--maxWorkers 1</code> argument to <code>jest ...</code> command by default. Since <code>detox@18.19.0</code>, the control over <code>maxWorkers</code> count has been transfered to Jest config files, and that allows you to set any other value as a default <code>maxWorkers</code> count.</td></tr></tbody></table><p>A typical Detox configuration in <code>.detoxrc.json</code> file looks like:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;testRunner&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jest&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;runnerConfig&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e2e/config.json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;skipLegacyWorkersInjection&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;devices&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;simulator&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ios.simulator&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;device&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;iPhone 12 Pro Max&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;apps&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ios.release&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ios.app&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;binaryPath&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ios/build/Build/Products/Release-iphonesimulator/example.app&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;build&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;...xcodebuild command...&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;configurations&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ios.sim.release&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;device&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;simulator&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;app&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ios.release&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_y2LR" id="e2econfigjson"><code>e2e/config.json</code><a aria-hidden="true" class="hash-link" href="#e2econfigjson" title="Direct link to heading">â€‹</a></h5><table><thead><tr><th>Property</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>maxWorkers</code></td><td><code>1</code></td><td><em>Recommended.</em> When being used with <code>skipLegacyWorkersInjection: true</code> in Detox config, it prevents overallocation of mobile devices in the light of Jestâ€™s default logic (<code>= cpusCount â€” 1</code>), when you do not pass any specific worker count. To override it, <a href="/Detox/docs/api/detox-cli#test">use CLI arguments</a>, or see <a href="https://jestjs.io/docs/configuration#maxworkers-number--string" target="_blank" rel="noopener noreferrer">Jest documentation</a> if you plan to change the default value in the config.</td></tr><tr><td><code>testEnvironment</code></td><td><code>&quot;./environment&quot;</code></td><td><em>Required.</em> Needed for the proper functioning of Jest and Detox. See <a href="https://jestjs.io/docs/en/configuration#testenvironment-string" target="_blank" rel="noopener noreferrer">Jest documentation</a> for more details.</td></tr><tr><td><code>testRunner</code></td><td><code>&quot;jest-circus/runner&quot;</code></td><td><em>Required.</em> Needed for the proper functioning of Jest and Detox. See <a href="https://jestjs.io/docs/en/configuration#testrunner-string" target="_blank" rel="noopener noreferrer">Jest documentation</a> for more details.</td></tr><tr><td><code>testTimeout</code></td><td><code>120000</code></td><td><em>Required</em>. Overrides the default timeout (5 seconds), which is usually too short to complete a single end-to-end test.</td></tr><tr><td><code>reporters</code></td><td><code>[&quot;detox/runners/jest/streamlineReporter&quot;]</code></td><td><em>Recommended.</em> Sets up our streamline replacement for <a href="https://jestjs.io/docs/en/configuration#reporters-array-modulename-modulename-options" target="_blank" rel="noopener noreferrer">Jestâ€™s default reporter</a>, which removes Jestâ€™s default buffering of <code>console.log()</code> output. That is helpful for end-to-end tests since log messages appear on the screen without any artificial delays. For more context, <a href="/Detox/docs/guide/migration#migrating-to-1270-from-older-nonbreaking">read Detox 12.7.0 migration guide</a>.</td></tr><tr><td><code>verbose</code></td><td><code>true</code></td><td><em>Conditional.</em> Must be <code>true</code> if above you have replaced Jestâ€™s default reporter with Detoxâ€™s <code>streamlineReporter</code>. Optional otherwise.</td></tr></tbody></table><p>A typical <code>jest-circus</code> configuration in <code>e2e/config.json</code> file would look like:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;testRunner&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jest-circus/runner&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;testEnvironment&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./environment&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;testTimeout&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">120000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;reporters&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;detox/runners/jest/streamlineReporter&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;verbose&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_y2LR" id="e2eenvironmentjs"><code>e2e/environment.js</code><a aria-hidden="true" class="hash-link" href="#e2eenvironmentjs" title="Direct link to heading">â€‹</a></h5><p>If you are not familiar with Environment concept in Jest, you could check <a href="https://jestjs.io/docs/en/configuration#testenvironment-string" target="_blank" rel="noopener noreferrer">their documentation</a>.</p><p>For Detox, having a <code>CustomDetoxEnvironment</code> class derived from <code>NodeEnvironment</code> enables implementing cross-cutting concerns such as taking screenshots the exact moment a test function (it/test) or a hook (e.g., beforeEach) fails, skip adding tests if they have <code>:ios:</code> or <code>:android:</code> within their title, starting device log recordings before test starts and so on.</p><p>API of <code>CustomDetoxEnvironment</code> is not entirely public in a sense that thereâ€™s no guide on how to write custom <code>DetoxCircusListeners</code> and override <code>initDetox()</code> and <code>cleanupDetox()</code> protected methods, since this is not likely to be needed for typical projects, but this is under consideration if there appears specific demand. You may want to check out this <a href="https://github.com/wix/Detox/pull/2009#issuecomment-648971528" target="_blank" rel="noopener noreferrer">simple example</a> of overriding <code>initDetox()</code>, or some <a href="https://github.com/wix/Detox/pull/2009#issuecomment-649342823" target="_blank" rel="noopener noreferrer">alternative approaches</a> to overriding <code>initDetox()</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">DetoxCircusEnvironment</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">SpecReporter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token maybe-class-name">WorkerAssignReporter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;detox/runners/jest-circus&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">CustomDetoxEnvironment</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">DetoxCircusEnvironment</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">config</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Can be safely removed, if you are content with the default value (=300000ms)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">initTimeout</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// This takes care of generating status logs on a per-spec basis. By default, Jest only reports at file-level.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// This is strictly optional.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">registerListeners</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token maybe-class-name">SpecReporter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token maybe-class-name">WorkerAssignReporter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">CustomDetoxEnvironment</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>Notes:</strong></p><ul><li>The custom <code>SpecReporter</code> is recommended to be registered as a listener. It takes care of logging on a per-spec basis (i.e. when <code>it(&#x27;...&#x27;)</code> functions start and end) â€” which Jest does not do by default.</li><li>The custom <code>WorkerAssignReporter</code> prints for every next test suite which device is assigned to its execution.</li></ul><p>This is how a typical Jest log output looks when <code>SpecReporter</code> and <code>WorkerAssignReporter</code> are enabled in <code>streamline-reporter</code> is set up in <code>config.json</code> and
<code>SpecReporter</code> added in <code>e2e/environment.js</code>:</p><p><img alt="Streamlined output" src="/Detox/assets/images/streamlined_logging-4ad2e1c374cd34a97dfc9a9f090ddcb6.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="writing-tests">Writing Tests<a aria-hidden="true" class="hash-link" href="#writing-tests" title="Direct link to heading">â€‹</a></h3><p>There are some things you should notice:</p><ul><li>Donâ€™t worry about mocks being used, Detox works on the compiled version of your app.</li><li>Detox exposes its primitives (<code>expect</code>, <code>device</code>, ...) globally, it will override Jestâ€™s global <code>expect</code> object.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="parallel-test-execution">Parallel Test Execution<a aria-hidden="true" class="hash-link" href="#parallel-test-execution" title="Direct link to heading">â€‹</a></h3><p>Through Detox&#x27; CLI, Jest can be started with <a href="/Detox/docs/guide/parallel-test-execution">multiple workers</a> that run tests simultaneously, e.g.:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">detox </span><span class="token builtin class-name">test</span><span class="token plain"> --configuration </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">yourConfigurationName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> --workers </span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this mode, Jest effectively assigns one worker per each test file.
Per-spec logging offered by the <code>SpecReporter</code> mentioned earlier, does not necessarily make sense, as the workers&#x27; outputs get mixed up.</p><p>By default, we disable <code>SpecReporter</code> in a multi-workers environment.
If you wish to force-enable it nonetheless, the <a href="/Detox/docs/api/detox-cli#test"><code>--jest-report-specs</code></a> CLI option can be used with <code>detox test</code>, e.g.:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">detox </span><span class="token builtin class-name">test</span><span class="token plain"> --configuration </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">yourConfigurationName</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> --workers </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> --jest-report-specs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-run-unit-and-e2e-tests-in-the-same-project">How to Run Unit and E2E Tests in the Same Project<a aria-hidden="true" class="hash-link" href="#how-to-run-unit-and-e2e-tests-in-the-same-project" title="Direct link to heading">â€‹</a></h3><ul><li>Create different Jest configs for unit and E2E tests, e.g. in <code>e2e/config.json</code> (for Detox) and <code>jest.config.js</code>
(for unit tests). For example, in Jestâ€™s E2E config you can set <code>testRegex</code> to look for <code>\.e2e.js$</code> regexp,
and this way avoid accidental triggering of unit tests with <code>.test.js</code> extension.</li><li>To run your E2E tests, use <code>detox test</code> command (or <code>npx detox test</code>, if you havenâ€™t installed <code>detox-cli</code>).</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wix/Detox/edit/master/docs/../docs/Guide.Jest.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Detox/docs/guide/migration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Migration Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Detox/docs/guide/mocha"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mocha Setup Guide<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#jest-setup-guide" class="table-of-contents__link toc-highlight">Jest Setup Guide</a><ul><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#writing-tests" class="table-of-contents__link toc-highlight">Writing Tests</a></li><li><a href="#parallel-test-execution" class="table-of-contents__link toc-highlight">Parallel Test Execution</a></li><li><a href="#how-to-run-unit-and-e2e-tests-in-the-same-project" class="table-of-contents__link toc-highlight">How to Run Unit and E2E Tests in the Same Project</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/Detox/docs/introduction/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/Detox/docs/contributing">Contributing to Detox</a></li></ul></div><div class="col footer__col"><div class="footer__title">Support</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/detox" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Ask a question on Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/wix/Detox/issues/new/choose" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Create new issue on Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/wix/Detox" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/detoxe2e/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/Detox/assets/js/runtime~main.841fd8d4.js"></script>
<script src="/Detox/assets/js/main.866b3762.js"></script>
</body>
</html>